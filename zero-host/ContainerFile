# ContainerFile for the Zero Host (ROS 2 BLE Bridge)
FROM ros:jazzy

# Install system dependencies for BlueZ, D-Bus, and Micro-ROS
RUN apt-get update && \
    apt-get install -y \
    bluez \
    python3-dbus \
    python3-gi \
    libgirepository1.0-dev \
    ros-jazzy-micro-ros-agent && \
    rm -rf /var/lib/apt/lists/*

# Create a ROS 2 workspace
WORKDIR /ros2_ws

# Copy the entire package into the workspace
COPY . /ros2_ws/src/ble_ros_bridge/

# Install ROS dependencies
# RUN . /opt/ros/jazzy/setup.sh && \
#     rosdep install -i --from-path src --rosdistro jazzy -y
# The above command is commented out as we don't have custom message types
# and all other dependencies are installed via apt.

# Build the workspace (even if it's just Python)
RUN . /opt/ros/jazzy/setup.sh && \
    colcon build --packages-select ble_ros_bridge

# Set up the entrypoint to run the ROS 2 launch file
CMD ["/bin/bash", "-c", "source /ros2_ws/install/setup.bash && ros2 launch ble_ros_bridge bridge_launch.py"]
